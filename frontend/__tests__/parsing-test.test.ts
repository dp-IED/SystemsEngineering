import { parseExcelData, Campaign } from "@/components/dashboard/parseExcelData";

describe("Excel File Parsing", () => {
  it("should correctly parse a predetermined string[][] representation of a table", async () => {
    const input_data = [
      [
        "PO_Number",
        "StartDate",
        "EndDate",
        "POCloseDownDate",
        "Market",
        "Campaign",
        "Channel",
        "PlannedSpend",
        "ReservedBudget",
        "TotalBudget",
        "NetBillable",
        "AgencyCommission",
        "LevyASBOF",
        "TotalPOValue",
        "TotalInvoicedToDate",
        "POValueRemaining",
      ],
      [
        "PO00060490",
        null,
        null,
        null,
        "UK",
        "Bleu",
        "Display",
        null,
        null,
        null,
        818910,
        32756.4,
        8189.1,
        null,
        859855.5,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        null,
        "Video",
        null,
        null,
        null,
        1275390,
        38261.7,
        12753.9,
        null,
        1326405.6,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        "Bleu H1",
        "Social",
        null,
        null,
        null,
        985500,
        34492.50000000001,
        9855,
        null,
        1029847.5,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        null,
        "Total",
        4600000,
        4600,
        23326600,
        3079800,
        105510.6,
        30798,
        23462908.6,
        3216108.6,
        20246800,
      ],
      [
        "PO00062541",
        null,
        null,
        null,
        "UK",
        "Les Beiges",
        "Video",
        null,
        null,
        null,
        113400,
        10490.625,
        1134,
        null,
        125024.625,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        "Les Beiges HERO",
        "Display",
        null,
        null,
        null,
        323460,
        11321.1,
        3234.6,
        null,
        338015.7,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        null,
        "Social",
        null,
        null,
        null,
        206955,
        7243.425,
        2069.55,
        null,
        216267.975,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        null,
        "Total",
        23000000,
        28750,
        27628750,
        643815,
        29055.15,
        6438.15,
        27664243.3,
        679308.3,
        26984935,
      ],
      [
        "PO00062544",
        null,
        null,
        null,
        "IRE",
        "C50/07",
        "Social",
        null,
        null,
        null,
        63000,
        2205,
        630,
        null,
        65835,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        null,
        null,
        null,
        null,
        null,
        132210,
        4627.35,
        1322.1,
        null,
        138159.45,
      ],
      [
        null,
        null,
        null,
        null,
        "IRE",
        null,
        "Total",
        9254280,
        28750,
        13828750,
        63000,
        2205,
        630,
        13831585,
        65835,
        13765750,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        null,
        null,
        23000000,
        28750,
        27628750,
        132210,
        4627.35,
        1322.1,
        27634699.45,
        138159.45,
        27496540,
      ],
      [
        "PO00062721",
        null,
        null,
        null,
        "UK",
        "CHANELUKPPC2024",
        "PPC",
        null,
        null,
        null,
        557100,
        19498.5,
        5571,
        null,
        582169.5,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        null,
        "Total",
        3450000,
        34500,
        46034500,
        557100,
        19498.5,
        5571,
        46059569.5,
        582169.5,
        45477400,
      ],
      [
        "PO00068664",
        null,
        null,
        null,
        "IRE",
        "No.5 Leau",
        "OOH",
        null,
        null,
        null,
        73935,
        2587.725,
        739.35,
        null,
        77262.075,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        null,
        "Social",
        null,
        null,
        null,
        232245,
        8128.575000000001,
        2322.45,
        null,
        242696.025,
      ],
      [
        null,
        null,
        null,
        null,
        "IRE",
        null,
        "Total",
        null,
        null,
        null,
        73935,
        2587.725,
        739.35,
        null,
        77262.075,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        null,
        null,
        null,
        null,
        null,
        232245,
        8128.575000000001,
        2322.45,
        null,
        242696.025,
      ],
      [
        "PO00074720",
        null,
        null,
        null,
        "IRE",
        "N1 H2",
        "Social",
        null,
        null,
        null,
        179820,
        5394.6,
        1798.2,
        null,
        187012.8,
      ],
      [
        null,
        null,
        null,
        null,
        "IRE",
        null,
        "Total",
        9062000,
        10350,
        9210350,
        179820,
        5394.6,
        1798.2,
        9217542.8,
        187012.8,
        9030530,
      ],
      [
        "PO00060496",
        null,
        null,
        null,
        "UK",
        "F&BAPRDEC24FEE",
        "Retainer Fee",
        null,
        null,
        null,
        21600,
        648,
        216,
        null,
        22464,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        "REGIONALI&AFEEAPRDEC",
        null,
        null,
        null,
        null,
        18270,
        548.1,
        182.7,
        null,
        19000.8,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        "REGIONALOPSAPRDEC24",
        null,
        null,
        null,
        null,
        1080,
        37.8,
        10.8,
        null,
        1128.6,
      ],
      [
        null,
        null,
        null,
        null,
        "UK",
        null,
        "Total",
        null,
        null,
        null,
        40950,
        1233.9,
        409.5,
        null,
        42593.4,
      ],
    ];
    const parse_result = parseExcelData(input_data);
    const expected_output: Campaign[] = [
    {
        "poNumber": "PO00060490",
        "name": "Bleu",
        "market": "UK",
        "financials": {
            "netBillable": 3079800,
            "agencyCommission": 105510.6,
            "levyASBOF": 30798,
            "invoiceVal": 23462908.6,
            "plannedSpend": 4600000,
            "reservedBudget": 4600,
            "totalBudget": 23326600,
            "totalInvoicedToDate": 3216108.6,
            "poValueRemaining": 20246800
        },
        "channels": [
            {
                "name": "Display",
                "financials": {
                    "netBillable": 818910,
                    "agencyCommission": 32756.4,
                    "levyASBOF": 8189.1,
                    "invoiceVal": 0,
                    "plannedSpend": 0,
                    "reservedBudget": 0,
                    "totalBudget": 0,
                    "totalInvoicedToDate": 859855.5,
                    "poValueRemaining": 0
                }
            },
            {
                "name": "Video",
                "financials": {
                    "netBillable": 1275390,
                    "agencyCommission": 38261.7,
                    "levyASBOF": 12753.9,
                    "invoiceVal": 0,
                    "plannedSpend": 0,
                    "reservedBudget": 0,
                    "totalBudget": 0,
                    "totalInvoicedToDate": 1326405.6,
                    "poValueRemaining": 0
                }
            },
            {
                "name": "Social",
                "financials": {
                    "netBillable": 985500,
                    "agencyCommission": 34492.50000000001,
                    "levyASBOF": 9855,
                    "invoiceVal": 0,
                    "plannedSpend": 0,
                    "reservedBudget": 0,
                    "totalBudget": 0,
                    "totalInvoicedToDate": 1029847.5,
                    "poValueRemaining": 0
                }
            }
        ]
    },
    {
        "poNumber": "PO00062541",
        "name": "Les Beiges",
        "market": "UK",
        "financials": {
            "netBillable": 643815,
            "agencyCommission": 29055.15,
            "levyASBOF": 6438.15,
            "invoiceVal": 27664243.3,
            "plannedSpend": 23000000,
            "reservedBudget": 28750,
            "totalBudget": 27628750,
            "totalInvoicedToDate": 679308.3,
            "poValueRemaining": 26984935
        },
        "channels": [
            {
                "name": "Video",
                "financials": {
                    "netBillable": 113400,
                    "agencyCommission": 10490.625,
                    "levyASBOF": 1134,
                    "invoiceVal": 0,
                    "plannedSpend": 0,
                    "reservedBudget": 0,
                    "totalBudget": 0,
                    "totalInvoicedToDate": 125024.625,
                    "poValueRemaining": 0
                }
            },
            {
                "name": "Display",
                "financials": {
                    "netBillable": 323460,
                    "agencyCommission": 11321.1,
                    "levyASBOF": 3234.6,
                    "invoiceVal": 0,
                    "plannedSpend": 0,
                    "reservedBudget": 0,
                    "totalBudget": 0,
                    "totalInvoicedToDate": 338015.7,
                    "poValueRemaining": 0
                }
            },
            {
                "name": "Social",
                "financials": {
                    "netBillable": 206955,
                    "agencyCommission": 7243.425,
                    "levyASBOF": 2069.55,
                    "invoiceVal": 0,
                    "plannedSpend": 0,
                    "reservedBudget": 0,
                    "totalBudget": 0,
                    "totalInvoicedToDate": 216267.975,
                    "poValueRemaining": 0
                }
            }
        ]
    },
    {
        "poNumber": "PO00062544",
        "name": "C50/07",
        "market": "IRE",
        "financials": {
            "netBillable": 63000,
            "agencyCommission": 2205,
            "levyASBOF": 630,
            "invoiceVal": 13831585,
            "plannedSpend": 9254280,
            "reservedBudget": 28750,
            "totalBudget": 13828750,
            "totalInvoicedToDate": 65835,
            "poValueRemaining": 13765750
        },
        "channels": [
            {
                "name": "Social",
                "financials": {
                    "netBillable": 63000,
                    "agencyCommission": 2205,
                    "levyASBOF": 630,
                    "invoiceVal": 0,
                    "plannedSpend": 0,
                    "reservedBudget": 0,
                    "totalBudget": 0,
                    "totalInvoicedToDate": 65835,
                    "poValueRemaining": 0
                }
            }
        ]
    },
    {
        "poNumber": "PO00062721",
        "name": "CHANELUKPPC2024",
        "market": "UK",
        "financials": {
            "netBillable": 557100,
            "agencyCommission": 19498.5,
            "levyASBOF": 5571,
            "invoiceVal": 46059569.5,
            "plannedSpend": 3450000,
            "reservedBudget": 34500,
            "totalBudget": 46034500,
            "totalInvoicedToDate": 582169.5,
            "poValueRemaining": 45477400
        },
        "channels": [
            {
                "name": "PPC",
                "financials": {
                    "netBillable": 557100,
                    "agencyCommission": 19498.5,
                    "levyASBOF": 5571,
                    "invoiceVal": 0,
                    "plannedSpend": 0,
                    "reservedBudget": 0,
                    "totalBudget": 0,
                    "totalInvoicedToDate": 582169.5,
                    "poValueRemaining": 0
                }
            }
        ]
    },
    {
        "poNumber": "PO00068664",
        "name": "No.5 Leau",
        "market": "IRE",
        "financials": {
            "netBillable": 73935,
            "agencyCommission": 2587.725,
            "levyASBOF": 739.35,
            "invoiceVal": 0,
            "plannedSpend": 0,
            "reservedBudget": 0,
            "totalBudget": 0,
            "totalInvoicedToDate": 77262.075,
            "poValueRemaining": 0
        },
        "channels": [
            {
                "name": "OOH",
                "financials": {
                    "netBillable": 73935,
                    "agencyCommission": 2587.725,
                    "levyASBOF": 739.35,
                    "invoiceVal": 0,
                    "plannedSpend": 0,
                    "reservedBudget": 0,
                    "totalBudget": 0,
                    "totalInvoicedToDate": 77262.075,
                    "poValueRemaining": 0
                }
            },
            {
                "name": "Social",
                "financials": {
                    "netBillable": 232245,
                    "agencyCommission": 8128.575000000001,
                    "levyASBOF": 2322.45,
                    "invoiceVal": 0,
                    "plannedSpend": 0,
                    "reservedBudget": 0,
                    "totalBudget": 0,
                    "totalInvoicedToDate": 242696.025,
                    "poValueRemaining": 0
                }
            }
        ]
    },
    {
        "poNumber": "PO00074720",
        "name": "N1 H2",
        "market": "IRE",
        "financials": {
            "netBillable": 179820,
            "agencyCommission": 5394.6,
            "levyASBOF": 1798.2,
            "invoiceVal": 9217542.8,
            "plannedSpend": 9062000,
            "reservedBudget": 10350,
            "totalBudget": 9210350,
            "totalInvoicedToDate": 187012.8,
            "poValueRemaining": 9030530
        },
        "channels": [
            {
                "name": "Social",
                "financials": {
                    "netBillable": 179820,
                    "agencyCommission": 5394.6,
                    "levyASBOF": 1798.2,
                    "invoiceVal": 0,
                    "plannedSpend": 0,
                    "reservedBudget": 0,
                    "totalBudget": 0,
                    "totalInvoicedToDate": 187012.8,
                    "poValueRemaining": 0
                }
            }
        ]
    },
    {
        "poNumber": "PO00060496",
        "name": "F&BAPRDEC24FEE",
        "market": "UK",
        "financials": {
            "netBillable": 40950,
            "agencyCommission": 1233.9,
            "levyASBOF": 409.5,
            "invoiceVal": 0,
            "plannedSpend": 0,
            "reservedBudget": 0,
            "totalBudget": 0,
            "totalInvoicedToDate": 42593.4,
            "poValueRemaining": 0
        },
        "channels": [
            {
                "name": "Retainer Fee",
                "financials": {
                    "netBillable": 21600,
                    "agencyCommission": 648,
                    "levyASBOF": 216,
                    "invoiceVal": 0,
                    "plannedSpend": 0,
                    "reservedBudget": 0,
                    "totalBudget": 0,
                    "totalInvoicedToDate": 22464,
                    "poValueRemaining": 0
                }
            }
        ]
    }
];
    expect(parse_result).toStrictEqual(expected_output)
  });
});
